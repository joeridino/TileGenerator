// Copyright (c) 2016 Joe Ridino
var TileGenerator={};!function(){"use strict";TileGenerator.Oop={},TileGenerator.Oop.extend=function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t}}(),function(){"use strict";TileGenerator.Array={},TileGenerator.Array.randomize=function(e){var t,i,n,r=e.length;for(t=0;t<e.length;t+=1)i=Math.floor(Math.random()*r),n=e[i],e[i]=e[r-1],e[r-1]=n,r-=1},TileGenerator.Array.getRandomWeightedIndex=function(e){var t,i,n=0,r=0;for(t=0;t<e.length;t+=1)n+=e[t];for(i=Math.floor(Math.random()*n),t=0;t<e.length;t+=1)if(r+=e[t],r>i||t===e.length-1)return t;return-1}}(),function(){"use strict";TileGenerator.Dom={},TileGenerator.Dom.getParentNodeByClass=function(e,t){for(;null!==(e=e.parentNode);)if(e.classList&&e.classList.contains(t))return e;return null},TileGenerator.Dom.getSiblingIndex=function(e){for(var t=0;null!==(e=e.previousSibling);)t+=1;return t}}(),function(){"use strict";TileGenerator.Hex={},TileGenerator.Hex.Map={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15},TileGenerator.Hex.simpleToDecArray=function(e){var t=[];return t[0]=TileGenerator.Hex.hexComponentToDec(e.slice(1,3)),t[1]=TileGenerator.Hex.hexComponentToDec(e.slice(3,5)),t[2]=TileGenerator.Hex.hexComponentToDec(e.slice(5)),t},TileGenerator.Hex.hexComponentToDec=function(e){var t,i=0,n=0;for(t=e.length-1;t>=0;t-=1)n+=TileGenerator.Hex.Map[e[t]]*Math.pow(16,i),i+=1;return n},TileGenerator.Hex.isSimpleHex=function(e){return/^#([0-9a-f]{2}){3}$/i.test(e)}}(),function(){"use strict";TileGenerator.Dec={},TileGenerator.Dec.HexValues=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],TileGenerator.Dec.decArrayToSimpleHex=function(e){var t,i="#";for(t=0;t<e.length;t+=1)i+=TileGenerator.Dec.decComponentToHex(e[t]);return i},TileGenerator.Dec.decComponentToHex=function(e){for(var t="";0!==e;)t=TileGenerator.Dec.HexValues[e%16]+t,e=Math.floor(e/16);switch(t.length){case 0:t=TileGenerator.Dec.HexValues[0]+TileGenerator.Dec.HexValues[0];break;case 1:t=TileGenerator.Dec.HexValues[0]+t}return t}}(),function(){"use strict";TileGenerator.Settings=function(){this._width=128,this._height=128,this._colors=[[255,0,0],[0,255,0]],this._colorWeights=[100,100],this._imageElement=null},TileGenerator.Settings.VERSION="1.1",TileGenerator.Settings.prototype.onLoad=function(){var e;try{e=window.localStorage.getItem("settings"),e&&(e=JSON.parse(e),this._width=e.width,this._height=e.height,e.version?this._colors=e.colors:this._colors=this._convertHexColors(e.colors),this._colorWeights=e.colorWeights)}catch(t){}window.addEventListener("beforeunload",this._saveSettings.bind(this))},TileGenerator.Settings.prototype.getWidth=function(){return this._width},TileGenerator.Settings.prototype.setWidth=function(e){return this._width=e,this},TileGenerator.Settings.prototype.getHeight=function(){return this._height},TileGenerator.Settings.prototype.setHeight=function(e){return this._height=e,this},TileGenerator.Settings.prototype.getColor=function(e){return this._colors[e]},TileGenerator.Settings.prototype.getColors=function(){return this._colors},TileGenerator.Settings.prototype.getNumColors=function(){return this._colors.length},TileGenerator.Settings.prototype.addColor=function(e){return this._colors.push(e),this},TileGenerator.Settings.prototype.updateColor=function(e,t){return this._colors[e]=t,this},TileGenerator.Settings.prototype.removeColor=function(e){return this._colors.splice(e,1),this},TileGenerator.Settings.prototype.getColorWeight=function(e){return this._colorWeights[e]},TileGenerator.Settings.prototype.getColorWeights=function(){return this._colorWeights},TileGenerator.Settings.prototype.getNumColorWeights=function(){return this._colorWeights.length},TileGenerator.Settings.prototype.addColorWeight=function(e){return this._colorWeights.push(e),this},TileGenerator.Settings.prototype.updateColorWeight=function(e,t){return this._colorWeights[e]=t,this},TileGenerator.Settings.prototype.removeColorWeight=function(e){return this._colorWeights.splice(e,1),this},TileGenerator.Settings.prototype.getImageElement=function(){return this._imageElement},TileGenerator.Settings.prototype.setImageElement=function(e){return this._imageElement=e,this},TileGenerator.Settings.prototype._saveSettings=function(){var e;try{var e=JSON.stringify({version:TileGenerator.Settings.VERSION,width:this._width,height:this._height,colors:this._colors,colorWeights:this._colorWeights});window.localStorage.setItem("settings",e)}catch(t){}},TileGenerator.Settings.prototype._convertHexColors=function(e){var t,i=[];for(t=0;t<e.length;t+=1)i.push(TileGenerator.Hex.simpleToDecArray(e[t]));return i}}(),function(){"use strict";var e=null;TileGenerator.Main=function(){this._settings=new TileGenerator.Settings,this._ui=new TileGenerator.Ui,this._algos={}},TileGenerator.Main.getRef=function(){return e},TileGenerator.Main.prototype.onLoad=function(){var e,t;for(this._settings.onLoad(),this._ui.onLoad(),e=TileGenerator.AlgoFactory.getAlgoInstances(),t=0;t<e.length;t+=1)this._ui.addAlgoToDom(e[t]),this._algos[e[t].getId()]=e[t];this._ui.onLoadEnd()},TileGenerator.Main.prototype.getAlgo=function(e){return this._algos[e]},TileGenerator.Main.prototype.getSettings=function(){return this._settings},window.onload=function(){e=new TileGenerator.Main,e.onLoad()}}(),function(){"use strict";TileGenerator.Ui=function(){this._settings=null,this._canvasList={},this._ctxList={},this._canvasesContainerElement=null,this._canvasesElement=null,this._canvasContainerTplElement=null,this._dimElement=null,this._progressElement=null,this._lastDropTarget=null,this._fileElement=null,this._fileRemoveElement=null,this._filePreviewElement=null,this._colorsElement=null,this._newColorElement=null,this._colorContainerTplElement=null,this._redrawElement=null,this._sizeElement=null,this._sizes=[[32,32],[64,64],[96,96],[128,128],[160,160],[192,192]],this._map=null},TileGenerator.Ui.prototype.onLoad=function(){this._settings=TileGenerator.Main.getRef().getSettings(),this._canvasesContainerElement=document.getElementById("tg-canvases"),this._canvasesElement=document.getElementById("tg-canvases-dynamic"),this._canvasesContainerElement.addEventListener("drop",this._onDropCanvases.bind(this)),this._canvasesContainerElement.addEventListener("dragenter",this._onDragEnterCanvases.bind(this)),this._canvasesContainerElement.addEventListener("dragover",this._onDragOverCanvases.bind(this)),this._canvasesContainerElement.addEventListener("dragleave",this._onDragLeaveCanvases.bind(this)),this._canvasContainerTplElement=document.getElementById("tg-canvas-container-template"),this._dimElement=document.getElementById("tg-dim"),this._progressElement=document.getElementById("tg-progress"),this._fileElement=document.getElementById("tg-file"),this._fileRemoveElement=document.getElementById("tg-file-remove"),this._filePreviewElement=document.getElementById("tg-file-preview"),this._fileElement.addEventListener("change",this._onFileChange.bind(this)),this._fileRemoveElement.addEventListener("click",this._onFileRemove.bind(this)),this._colorsElement=document.getElementById("tg-colors-dynamic"),this._newColorElement=document.getElementById("tg-new-color-btn"),this._newColorElement.addEventListener("click",this._onAddColor.bind(this)),this._colorContainerTplElement=document.getElementById("tg-color-container-template"),this._redrawElement=document.getElementById("tg-redraw-btn"),this._redrawElement.addEventListener("click",this._onRedraw.bind(this)),this._sizeElement=document.getElementById("tg-size"),this._populateSizes(),this._sizeElement.addEventListener("change",this._onChangeSize.bind(this)),this._sizeElement.addEventListener("keyup",this._onKeySize.bind(this)),this._addColorsFromSettings(),this._map=new TileGenerator.Map(this),this._map.onLoad()},TileGenerator.Ui.prototype.onLoadEnd=function(){this._redraw()},TileGenerator.Ui.prototype.addAlgoToDom=function(e){var t,i,n,r=!0,o=e.getDescription(),s=e.getId(),a=e.getTitle();n=this._canvasContainerTplElement.cloneNode(r),n.removeAttribute("id"),n.setAttribute("class","tg-canvas-container"),n.querySelector(".tg-canvas-title").textContent=a,n.querySelector(".tg-canvas-description").textContent=o,t=n.querySelector("canvas"),t.dataset.algoId=s,t.width=this._settings.getWidth(),t.height=this._settings.getHeight(),t.setAttribute("title",a),t.addEventListener("click",this._onClickCanvas.bind(this)),t.addEventListener("keyup",this._onKeyCanvas.bind(this)),i=t.getContext("2d"),this._canvasList[s]=t,this._ctxList[s]=i,this._canvasesElement.appendChild(n),e.setup(i)},TileGenerator.Ui.prototype.redrawAlgo=function(e){this._redrawAlgo(e)},TileGenerator.Ui.prototype._onClickCanvas=function(e){e.stopImmediatePropagation(),e.stopPropagation(),this._map.show(e.target)},TileGenerator.Ui.prototype._onKeyCanvas=function(e){e.stopImmediatePropagation(),e.stopPropagation(),13===e.which&&this._map.show(e.target)},TileGenerator.Ui.prototype._onDragEnterCanvases=function(e){this._lastDropTarget=e.target,this._canvasesContainerElement.classList.add("tg-drop-effect"),e.preventDefault()},TileGenerator.Ui.prototype._onDragOverCanvases=function(e){e.preventDefault()},TileGenerator.Ui.prototype._onDragLeaveCanvases=function(e){this._lastDropTarget===e.target&&this._canvasesContainerElement.classList.remove("tg-drop-effect")},TileGenerator.Ui.prototype._onDropCanvases=function(e){this._canvasesContainerElement.classList.remove("tg-drop-effect"),e.preventDefault(),e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length&&this._onNewFile(e.dataTransfer.files[0])},TileGenerator.Ui.prototype._onFileChange=function(e){var t=!1;this._fileElement.value&&(t=this._onNewFile(this._fileElement.files[0]),t||(this._fileElement.value=null))},TileGenerator.Ui.prototype._onNewFile=function(e){var t,i,n=1,r=!1;return/^image\//.test(e.type)?r&&e.size>1048576*n?(i=Math.round(e.size/1048576),alert("Image files should be no more than "+n+"MB in size.  Your file is ~"+i+"MB."),!1):(this._showProgress(),t=new FileReader,t.addEventListener("load",this._onFileLoad.bind(this)),t.addEventListener("error",this._onFileError.bind(this)),t.addEventListener("abort",this._onFileError.bind(this)),t.readAsDataURL(e),!0):(alert("Please upload an image file."),!1)},TileGenerator.Ui.prototype._onFileLoad=function(e){this._filePreviewElement.setAttribute("src",e.target.result),this._filePreviewElement.style.display="block",this._fileRemoveElement.style.display="block",this._settings.setImageElement(this._filePreviewElement),setTimeout(function(){this._hideProgress(),this._redraw()}.bind(this),150)},TileGenerator.Ui.prototype._onFileError=function(e){this._hideProgress(),alert("There was an error loading your file.  Please try again.")},TileGenerator.Ui.prototype._onFileRemove=function(e){this._fileElement.value=null,this._filePreviewElement.removeAttribute("src"),this._filePreviewElement.style.display="none",this._fileRemoveElement.style.display="none",this._settings.setImageElement(null),this._redraw()},TileGenerator.Ui.prototype._showProgress=function(){var e;this._dimElement.style.display="block",this._progressElement.style.display="block",e=this._progressElement.getBoundingClientRect(),this._progressElement.style.left=Math.max(Math.floor((window.innerWidth-e.width)/2),0)+"px",this._progressElement.style.top=Math.max(Math.floor((window.innerHeight-e.height)/2),0)+"px"},TileGenerator.Ui.prototype._hideProgress=function(){this._dimElement.style.display="none",this._progressElement.style.display="none"},TileGenerator.Ui.prototype._onAddColor=function(e){this._cloneColor(this._colorContainerTplElement)},TileGenerator.Ui.prototype._onCloneColor=function(e){var t=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container");this._cloneColor(t)},TileGenerator.Ui.prototype._onRemoveColor=function(e){var t,i;this._settings.getNumColors()>1?(t=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container"),i=TileGenerator.Dom.getSiblingIndex(t),this._settings.removeColor(i).removeColorWeight(i),this._colorsElement.removeChild(t),this._redraw()):alert("You must keep at least 1 color.")},TileGenerator.Ui.prototype._onChangeColor=function(e){var t,i=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container");t=TileGenerator.Dom.getSiblingIndex(i),this._settings.updateColor(t,TileGenerator.Hex.simpleToDecArray(e.target.value)),i.querySelector(".tg-color-value").value=e.target.value,this._redraw()},TileGenerator.Ui.prototype._onInputColorValue=function(e){var t,i,n;TileGenerator.Hex.isSimpleHex(e.target.value)&&(t=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container"),i=t.querySelector(".tg-color"),i.value=e.target.value,n=new Event("change"),i.dispatchEvent(n))},TileGenerator.Ui.prototype._onChangeColorValue=function(e){var t,i;TileGenerator.Hex.isSimpleHex(e.target.value)||(t=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container"),i=t.querySelector(".tg-color"),e.target.value=i.value)},TileGenerator.Ui.prototype._onInputColorWeight=function(e){var t=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container");t.querySelector(".tg-color-weight-value").textContent=e.target.value},TileGenerator.Ui.prototype._onChangeColorWeight=function(e){var t,i=TileGenerator.Dom.getParentNodeByClass(e.target,"tg-color-container"),n=parseInt(e.target.value,10);t=TileGenerator.Dom.getSiblingIndex(i),this._settings.getColorWeight(t)!==n&&(this._settings.updateColorWeight(t,n),this._redraw())},TileGenerator.Ui.prototype._onKeyColorWeight=function(e){this._onChangeColorWeight(e)},TileGenerator.Ui.prototype._onMouseColorWeight=function(e){this._onChangeColorWeight(e)},TileGenerator.Ui.prototype._onChangeSize=function(e){var t,i=parseInt(e.target.value,10);t=this._sizes[i],this._settings.getWidth()!==t[0]&&this._settings.getHeight()!==t[1]&&(this._settings.setWidth(t[0]).setHeight(t[1]),this._resizeCanvases(),this._callAlgoResized(),this._redraw())},TileGenerator.Ui.prototype._onKeySize=function(e){this._onChangeSize(e)},TileGenerator.Ui.prototype._onRedraw=function(){this._redraw()},TileGenerator.Ui.prototype._redraw=function(){var e;for(e in this._ctxList)this._ctxList.hasOwnProperty(e)&&this._redrawAlgo(e)},TileGenerator.Ui.prototype._redrawAlgo=function(e){var t=TileGenerator.Main.getRef().getAlgo(e);this._ctxList[e].clearRect(0,0,this._settings.getWidth(),this._settings.getHeight()),t.draw(this._ctxList[e])},TileGenerator.Ui.prototype._cloneColor=function(e){var t,i;i=e.querySelector(".tg-color").value,t=parseInt(e.querySelector(".tg-color-weight-range").value,10),this._addColorToDom(i,t),this._settings.addColor(TileGenerator.Hex.simpleToDecArray(i)).addColorWeight(t),this._redraw()},TileGenerator.Ui.prototype._addColorToDom=function(e,t){var i,n,r,o,s,a=!0;s=this._colorContainerTplElement.cloneNode(a),s.removeAttribute("id"),s.setAttribute("class","tg-color-container"),i=s.querySelector(".tg-color"),n=s.querySelector(".tg-color-value"),r=s.querySelector(".tg-color-weight-range"),o=s.querySelector(".tg-color-weight-value"),i.value=e,n.value=e,r.value=t,o.textContent=t,s.querySelector(".tg-clone-color-btn").addEventListener("click",this._onCloneColor.bind(this)),s.querySelector(".tg-remove-color-btn").addEventListener("click",this._onRemoveColor.bind(this)),i.addEventListener("change",this._onChangeColor.bind(this)),n.addEventListener("input",this._onInputColorValue.bind(this)),n.addEventListener("change",this._onChangeColorValue.bind(this)),r.addEventListener("input",this._onInputColorWeight.bind(this)),r.addEventListener("keyup",this._onKeyColorWeight.bind(this)),r.addEventListener("mouseup",this._onMouseColorWeight.bind(this)),this._colorsElement.appendChild(s)},TileGenerator.Ui.prototype._addColorsFromSettings=function(){var e,t,i;for(e=this._settings.getColors(),t=this._settings.getColorWeights(),i=0;i<e.length;i+=1)this._addColorToDom(TileGenerator.Dec.decArrayToSimpleHex(e[i]),t[i])},TileGenerator.Ui.prototype._parseSize=function(e){return/^[1-9][0-9]*$/.test(e)?parseInt(e,10):null},TileGenerator.Ui.prototype._resizeCanvases=function(){var e;for(e in this._canvasList)this._canvasList.hasOwnProperty(e)&&(this._canvasList[e].width=this._settings.getWidth(),this._canvasList[e].height=this._settings.getHeight());this._map.onResize()},TileGenerator.Ui.prototype._callAlgoResized=function(){var e,t;for(t in this._ctxList)this._ctxList.hasOwnProperty(t)&&(e=TileGenerator.Main.getRef().getAlgo(t),e.resized(this._ctxList[t]))},TileGenerator.Ui.prototype._populateSizes=function(){var e,t,i,n=this._settings.getHeight(),r=this._settings.getWidth();for(e=0;e<this._sizes.length;e+=1)i=document.createElement("option"),i.setAttribute("value",e),i.textContent=this._sizes[e][0]+"x"+this._sizes[e][1],this._sizeElement.appendChild(i),(0===e||this._sizes[e][0]==r&&this._sizes[e][1]==n)&&(t=i);t.setAttribute("selected","")}}(),function(){"use strict";TileGenerator.Map=function(e){this._ui=e,this._settings=null,this._dimElement=null,this._mapElement=null,this._mapCanvas=null,this._mapCtx=null,this._sourceCanvas=null,this._pattern=null,this._patterns=null,this._previousElement=null,this._nextElement=null,this._closeElement=null,this._redrawElement=null,this._patternsElement=null,this._closeHandler=this._onClickDim.bind(this),this._keyHandler=this._onKeyDocument.bind(this),this._previousHandler=this._onClickPrevious.bind(this),this._nextHandler=this._onClickNext.bind(this),this._redrawHandler=this._onClickRedraw.bind(this),this._patternHandler=this._onClickPattern.bind(this)},TileGenerator.Map.prototype.onLoad=function(){this._settings=TileGenerator.Main.getRef().getSettings(),this._dimElement=document.getElementById("tg-dim"),this._mapElement=document.getElementById("tg-map"),this._previousElement=this._mapElement.querySelector(".tg-map-link-previous"),this._nextElement=this._mapElement.querySelector(".tg-map-link-next"),this._closeElement=this._mapElement.querySelector(".tg-map-link-close"),this._redrawElement=this._mapElement.querySelector(".tg-map-link-redraw"),this._patternsElement=this._mapElement.querySelector(".tg-map-patterns"),this._patterns=TileGenerator.MapPatternFactory.getPatternInstances(),this._pattern=this._patterns[0],this._createCanvas(),this._resize(),this._rearrangeDom(),this._populateDomPatterns()},TileGenerator.Map.prototype.onResize=function(){this._resize()},TileGenerator.Map.prototype.show=function(e){this._sourceCanvas=e,this._dimElement.style.display="block",this._mapElement.style.display="block",this._populate(),this._draw(),this._position(),this._nextElement.focus(),document.addEventListener("keyup",this._keyHandler),this._dimElement.addEventListener("click",this._closeHandler),this._previousElement.addEventListener("click",this._previousHandler),this._nextElement.addEventListener("click",this._nextHandler),this._closeElement.addEventListener("click",this._closeHandler),this._redrawElement.addEventListener("click",this._redrawHandler),this._addPatternListeners()},TileGenerator.Map.prototype._hide=function(){var e=document.getElementById("tg-dim");e.style.display="none",this._mapElement.style.display="none",document.removeEventListener("keyup",this._keyHandler),this._dimElement.removeEventListener("click",this._closeHandler),this._previousElement.removeEventListener("click",this._previousHandler),this._nextElement.removeEventListener("click",this._nextHandler),this._closeElement.removeEventListener("click",this._closeHandler),this._redrawElement.removeEventListener("click",this._redrawHandler),this._removePatternListeners()},TileGenerator.Map.prototype._populate=function(){var e=TileGenerator.Dom.getParentNodeByClass(this._sourceCanvas,"tg-canvas-container");this._mapElement.querySelector(".tg-map-title").textContent=e.querySelector(".tg-canvas-title").textContent,this._mapElement.querySelector(".tg-map-description").textContent=e.querySelector(".tg-canvas-description").textContent},TileGenerator.Map.prototype._draw=function(){this._pattern.draw(this._sourceCanvas,this._mapCtx)},TileGenerator.Map.prototype._position=function(){var e=this._mapElement.getBoundingClientRect();this._mapElement.style.left=Math.max(Math.floor((window.innerWidth-e.width)/2)+window.pageXOffset,0)+"px",this._mapElement.style.top=Math.max(Math.floor((window.innerHeight-e.height)/2)+window.pageYOffset,0)+"px"},TileGenerator.Map.prototype._onKeyDocument=function(e){switch(e.which){case 27:this._hide();break;case 37:this._previous();break;case 39:this._next()}},TileGenerator.Map.prototype._onClickDim=function(e){this._hide(),e.preventDefault()},TileGenerator.Map.prototype._onClickPrevious=function(e){this._previous(),e.preventDefault()},TileGenerator.Map.prototype._onClickNext=function(e){this._next(),e.preventDefault()},TileGenerator.Map.prototype._onClickRedraw=function(e){this._ui.redrawAlgo(this._sourceCanvas.dataset.algoId),this._draw(),e.preventDefault()},TileGenerator.Map.prototype._onClickPattern=function(e){var t;e.target.classList.contains("tg-map-pattern-active")||(this._patternsElement.querySelector(".tg-map-pattern-active").classList.remove("tg-map-pattern-active"),t=TileGenerator.Dom.getSiblingIndex(e.target),e.target.classList.add("tg-map-pattern-active"),this._pattern=this._patterns[t],this._resize(),this._draw(),this._position())},TileGenerator.Map.prototype._changeCanvas=function(e){this._sourceCanvas=e,this._populate(),this._draw()},TileGenerator.Map.prototype._previous=function(){var e,t,i=TileGenerator.Dom.getParentNodeByClass(this._sourceCanvas,"tg-canvas-container");t=i.previousSibling,t||(e=TileGenerator.Dom.getParentNodeByClass(i,"tg-canvases-dynamic"),t=e.lastChild),this._changeCanvas(t.querySelector("canvas"))},TileGenerator.Map.prototype._next=function(){var e,t,i=TileGenerator.Dom.getParentNodeByClass(this._sourceCanvas,"tg-canvas-container");t=i.nextSibling,t||(e=TileGenerator.Dom.getParentNodeByClass(i,"tg-canvases-dynamic"),t=e.firstChild),this._changeCanvas(t.querySelector("canvas"))},TileGenerator.Map.prototype._createCanvas=function(){this._mapCanvas=document.getElementById("tg-map-canvas"),this._mapCtx=this._mapCanvas.getContext("2d")},TileGenerator.Map.prototype._resize=function(){this._mapCanvas.width=this._settings.getWidth()*this._pattern.getNumXTiles(),this._mapCanvas.height=this._settings.getHeight()*this._pattern.getNumYTiles()},TileGenerator.Map.prototype._rearrangeDom=function(){this._mapElement.parentNode!==document.body&&(this._mapElement.parentNode.removeChild(this._mapElement),this._dimElement.parentNode.removeChild(this._dimElement),document.body.appendChild(this._mapElement),document.body.appendChild(this._dimElement))},TileGenerator.Map.prototype._populateDomPatterns=function(){var e,t,i=this._patternsElement.querySelector("ul");for(e=0;e<this._patterns.length;e+=1)t=document.createElement("li"),0===e&&t.classList.add("tg-map-pattern-active"),t.setAttribute("tabindex","0"),t.setAttribute("title",this._patterns[e].getDescription()),t.textContent=this._patterns[e].getTitle(),i.appendChild(t)},TileGenerator.Map.prototype._addPatternListeners=function(){var e,t=this._patternsElement.querySelectorAll("li");for(e=0;e<t.length;e+=1)t[e].addEventListener("click",this._patternHandler)},TileGenerator.Map.prototype._removePatternListeners=function(){var e,t=this._patternsElement.querySelectorAll("li");for(e=0;e<t.length;e+=1)t[e].removeEventListener("click",this._patternHandler)}}(),function(){"use strict";TileGenerator.MapPattern=function(){this._title=null,this._description=null,this._numXTiles=0,this._numYTiles=0},TileGenerator.MapPattern.prototype.draw=function(e,t){},TileGenerator.MapPattern.prototype.getTitle=function(){return this._title},TileGenerator.MapPattern.prototype.getDescription=function(){return this._description},TileGenerator.MapPattern.prototype.getNumXTiles=function(){return this._numXTiles},TileGenerator.MapPattern.prototype.getNumYTiles=function(){return this._numYTiles}}(),function(){"use strict";var e=TileGenerator.MapPattern;TileGenerator.MapPatternRepeat=function(){var t;e.call(this),this._numXTiles=3,this._numYTiles=3,t=this._numXTiles+"x"+this._numYTiles,this._title=t+" Repeat",this._description="Tiles are repeated in a "+t+" pattern."},TileGenerator.Oop.extend(e,TileGenerator.MapPatternRepeat),TileGenerator.MapPatternRepeat.prototype.draw=function(e,t){var i,n,r,o;for(n=0;n<this._numYTiles;n+=1)for(i=0;i<this._numXTiles;i+=1)r=i*e.width,o=n*e.height,t.drawImage(e,r,o,e.width,e.height)}}(),function(){"use strict";var e=TileGenerator.MapPattern;TileGenerator.MapPatternSeamless=function(){var t;e.call(this),this._numXTiles=2,this._numYTiles=2,t=this._numXTiles+"x"+this._numYTiles,this._title=t+" Seamless",this._description="Tiles are flipped to create a seamless pattern."},TileGenerator.Oop.extend(e,TileGenerator.MapPatternSeamless),TileGenerator.MapPatternSeamless.prototype.draw=function(e,t){var i,n,r,o,s,a;for(o=0;o<this._numYTiles;o+=1)for(r=0;r<this._numXTiles;r+=1)i=1,n=1,s=r*e.width,a=o*e.height,r%2!==0&&(s=-(s+e.width),i=-1),o%2!==0&&(a=-(a+e.height),n=-1),t.scale(i,n),t.drawImage(e,s,a,e.width,e.height),t.setTransform(1,0,0,1,0,0)}}(),function(){"use strict";TileGenerator.MapPatternFactory={},TileGenerator.MapPatternFactory.getPatternInstances=function(){return[new TileGenerator.MapPatternRepeat,new TileGenerator.MapPatternSeamless]}}(),function(){"use strict";TileGenerator.Algo=function(e){this._settings=e,this._id=null,this._title=null,this._description=null,this._imageData=null,this._imageDataArray=null,this._imageDataModified=!1},TileGenerator.Algo.prototype.setup=function(e){this._createImageData(e)},TileGenerator.Algo.prototype.resized=function(e){this._createImageData(e)},TileGenerator.Algo.prototype.draw=function(e){this._setPixels(e),this._drawPixels(e)},TileGenerator.Algo.prototype.getId=function(){return this._id},TileGenerator.Algo.prototype.getTitle=function(){return this._title},TileGenerator.Algo.prototype.getDescription=function(){return this._description},TileGenerator.Algo.prototype._setPixel=function(e,t,i){var n=this._getPixelIndex(e,t.x,t.y);this._imageDataArray[n++]=i[0],this._imageDataArray[n++]=i[1],this._imageDataArray[n++]=i[2],this._imageDataArray[n++]=void 0===i[3]?255:i[3],this._imageDataModified=!0},TileGenerator.Algo.prototype._setBlockPixels=function(e,t,i){var n;for(n=0;n<t.length;n+=1)this._setPixel(e,t[n],i)},TileGenerator.Algo.prototype._getPixelIndex=function(e,t,i){return 4*(i*e.canvas.width+t)},TileGenerator.Algo.prototype._drawPixels=function(e){e.putImageData(this._imageData,0,0)},TileGenerator.Algo.prototype._createImageData=function(e){this._imageData=e.createImageData(e.canvas.width,e.canvas.height),this._imageDataArray=this._imageData.data,this._imageDataModified=!1}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoRandom=function(t){e.call(this,t),this._id="random",this._title="Random",this._description="Pixels are assigned a random color."},TileGenerator.Oop.extend(e,TileGenerator.AlgoRandom),TileGenerator.AlgoRandom.prototype._setPixels=function(e){var t,i,n,r=this._settings.getColors(),o=this._settings.getColorWeights(),s={};for(n=0;n<this._settings.getHeight();n+=1)for(i=0;i<this._settings.getWidth();i+=1)s.x=i,s.y=n,t=TileGenerator.Array.getRandomWeightedIndex(o),this._setPixel(e,s,r[t])}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoSmearing=function(t){e.call(this,t),this._id="smearing",this._title="Smearing",this._description="Pixels are assigned a continuous set of colors in random amounts."},TileGenerator.Oop.extend(e,TileGenerator.AlgoSmearing),TileGenerator.AlgoSmearing.prototype._setPixels=function(e){var t,i,n,r=this._settings.getColors(),o=this._settings.getColorWeights(),s=5,a=0,l=20,h=!0,g={};for(n=0;n<this._settings.getHeight();n+=1)for(i=0;i<this._settings.getWidth();i+=1)h&&(t=TileGenerator.Array.getRandomWeightedIndex(o),a=0,h=!1),a+=1,a>s+Math.random()*l&&(h=!0),g.x=i,g.y=n,this._setPixel(e,g,r[t])}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoBrick=function(t){e.call(this,t),this._id="brick",this._title="Brick",this._description="Rows of bricks.",this._brickHexColors=null,this._outlineHexColor=null,this._brickWidth=0,this._brickHeight=0,this._halfBrickWidth=0,this._numBricksX=0,this._numBricksY=0},TileGenerator.Oop.extend(e,TileGenerator.AlgoBrick),TileGenerator.AlgoBrick.prototype.draw=function(e){this._defineVariables(e),this._drawBricks(e)},TileGenerator.AlgoBrick.prototype._defineVariables=function(e){var t,i=this._settings.getColors(),n=this._settings.getColorWeights();for(this._brickHexColors=[],this._outlineHexColor=null,t=0;t<i.length;t+=1)n[t]>0&&(this._outlineHexColor?this._brickHexColors.push(TileGenerator.Dec.decArrayToSimpleHex(i[t])):this._outlineHexColor=TileGenerator.Dec.decArrayToSimpleHex(i[t]));0===this._brickHexColors.length&&this._brickHexColors.push(this._outlineHexColor),this._brickWidth=Math.floor(this._settings.getWidth()/4),this._halfBrickWidth=Math.floor(this._brickWidth/2),this._brickHeight=Math.floor(this._settings.getHeight()/8),this._numBricksX=Math.floor(this._settings.getWidth()/this._brickWidth),this._numBricksY=Math.floor(this._settings.getHeight()/this._brickHeight)},TileGenerator.AlgoBrick.prototype._drawBricks=function(e){var t,i,n,r,o=0,s=0;for(i=0;i<this._numBricksY;i+=1){for(o=0,e.fillStyle=this._brickHexColors[i%this._brickHexColors.length],r=i%2===0?this._numBricksX:this._numBricksX+1,t=0;r>t;t+=1)n=r===this._numBricksX||0!==t&&t!==r-1?this._brickWidth:this._halfBrickWidth,e.strokeStyle=this._outlineHexColor,e.fillRect(o,s,n,this._brickHeight),e.strokeRect(o+.5,s+.5,n-e.lineWidth,this._brickHeight-e.lineWidth),n===this._halfBrickWidth&&(0===t?this._unlineHalfBrick(e,o,s+e.lineWidth):this._unlineHalfBrick(e,o+n-e.lineWidth,s+e.lineWidth)),o+=n;s+=this._brickHeight}},TileGenerator.AlgoBrick.prototype._unlineHalfBrick=function(e,t,i){t+=.5,e.strokeStyle=e.fillStyle,e.beginPath(),e.moveTo(t,i),e.lineTo(t,i+this._brickHeight-2*e.lineWidth),e.stroke()}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoNeighbor=function(t){e.call(this,t)},TileGenerator.Oop.extend(e,TileGenerator.AlgoNeighbor),TileGenerator.AlgoNeighbor.prototype._setPixels=function(e){var t,i,n,r,o,s,a=this._settings.getColors(),l=this._settings.getColorWeights(),h={},g=[],c=0;for(s=0;s<this._settings.getHeight();s+=1)g.push(s);for(r=Math.floor(this._settings.getWidth()/10),TileGenerator.Array.randomize(g),this._imageDataModified&&this._createImageData(e),s=0;s<g.length;s+=1)for(o=0;o<this._settings.getWidth();o+=1)t=this._getRandomNeighborColor(e,o,s),null===t&&(i=TileGenerator.Array.getRandomWeightedIndex(l),t=a[i]),this._colorMatch(t,n)&&++c,c>r&&(c=0,i=TileGenerator.Array.getRandomWeightedIndex(l),t=a[i]),n=t,h.x=o,h.y=s,this._setPixel(e,h,t)},TileGenerator.AlgoNeighbor.prototype._getRandomNeighborColor=function(e,t,i){var n,r,o=[];if(o=this._getNeighbors(t,i),0===o.length)return null;for(TileGenerator.Array.randomize(o),n=0;n<o.length;n+=1)if(r=this._getPixelIndex(e,o[n].x,o[n].y),0!==this._imageDataArray[r+3])return[this._imageDataArray[r++],this._imageDataArray[r++],this._imageDataArray[r++]];return null},TileGenerator.AlgoNeighbor.prototype._colorMatch=function(e,t){return e&&t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]?!0:!1}}(),function(){"use strict";var e=TileGenerator.AlgoNeighbor;TileGenerator.AlgoNeighbor4=function(t){e.call(this,t),this._id="neighbor4",this._title="Neighbor 4",this._description="Pixel colors are based off 4 neighboring pixels (north, south, east, and west)."},TileGenerator.Oop.extend(e,TileGenerator.AlgoNeighbor4),TileGenerator.AlgoNeighbor4.prototype._getNeighbors=function(e,t){var i=[];return t>0&&i.push({x:e,y:t-1}),t<this._settings.getHeight()-1&&i.push({x:e,y:t+1}),e>0&&i.push({x:e-1,y:t}),e<this._settings.getWidth()-1&&i.push({x:e+1,y:t}),i}}(),function(){"use strict";var e=TileGenerator.AlgoNeighbor4;TileGenerator.AlgoNeighbor8=function(t){e.call(this,t),this._id="neighbor8",this._title="Neighbor 8",
this._description="Pixel colors are based off 8 neighboring pixels."},TileGenerator.Oop.extend(e,TileGenerator.AlgoNeighbor8),TileGenerator.AlgoNeighbor8.prototype._getNeighbors=function(t,i){var n=e.prototype._getNeighbors.call(this,t,i);return t>0&&i>0&&n.push({x:t-1,y:i-1}),t<this._settings.getWidth()-1&&i>0&&n.push({x:t+1,y:i-1}),t>0&&i<this._settings.getHeight()-1&&n.push({x:t-1,y:i+1}),t<this._settings.getWidth()-1&&i<this._settings.getHeight()-1&&n.push({x:t+1,y:i+1}),n}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoPixellation=function(t){e.call(this,t),this._id="pixellation",this._title="Pixellation",this._description="Blocks of pixels are assigned the same color based on random color values.",this._blockWidth=0,this._blockHeight=0,this._numBlocksX=0,this._numBlocksY=0},TileGenerator.Oop.extend(e,TileGenerator.AlgoPixellation),TileGenerator.AlgoPixellation.prototype._setPixels=function(e){var t,i,n,r,o=this._settings.getColors(),s=this._settings.getColorWeights();for(this._blockWidth=Math.floor(this._settings.getWidth()/8),this._blockHeight=Math.floor(this._settings.getHeight()/8),this._numBlocksX=Math.ceil(this._settings.getWidth()/this._blockWidth),this._numBlocksY=Math.ceil(this._settings.getHeight()/this._blockHeight),t=0;t<this._numBlocksY;t+=1)for(i=0;i<this._numBlocksX;i+=1)r=this._getBlockPositions(i,t),n=TileGenerator.Array.getRandomWeightedIndex(s),this._setBlockPixels(e,r,o[n])},TileGenerator.AlgoPixellation.prototype._getBlockPositions=function(e,t){var i,n,r,o,s,a,l=[];for(r=e*this._blockWidth,n=Math.min(r+this._blockWidth,this._settings.getWidth()),a=t*this._blockHeight,s=Math.min(a+this._blockHeight,this._settings.getHeight()),o=a;s>o;o+=1)for(i=r;n>i;i+=1)l.push({x:i,y:o});return l}}(),function(){"use strict";var e=TileGenerator.AlgoPixellation;TileGenerator.AlgoFilePixellation=function(t){e.call(this,t),this._id="file_pixellation",this._title="File Pixellation",this._description="Blocks of pixels are assigned the same color based on the selected image file."},TileGenerator.Oop.extend(e,TileGenerator.AlgoFilePixellation),TileGenerator.AlgoFilePixellation.prototype.draw=function(e){var t=this._settings.getImageElement();t?(this._drawImage(e),this._pixellateImage(e),this._drawPixels(e)):this._drawMissingImage(e)},TileGenerator.AlgoFilePixellation.prototype._drawMissingImage=function(e){e.fillStyle="black",e.fillRect(0,0,this._settings.getWidth(),this._settings.getHeight()),this._drawTextConditional(e,"Need File")||this._drawTextConditional(e,"File")},TileGenerator.AlgoFilePixellation.prototype._drawImage=function(e){var t=this._settings.getImageElement();e.drawImage(t,0,0,t.width,t.height,0,0,this._settings.getWidth(),this._settings.getHeight())},TileGenerator.AlgoFilePixellation.prototype._pixellateImage=function(e){var t,i,n,r,o=e.getImageData(0,0,this._settings.getWidth(),this._settings.getHeight()).data;for(this._blockWidth=4,this._blockHeight=4,this._numBlocksX=Math.ceil(this._settings.getWidth()/this._blockWidth),this._numBlocksY=Math.ceil(this._settings.getHeight()/this._blockHeight),t=0;t<this._numBlocksY;t+=1)for(i=0;i<this._numBlocksX;i+=1)r=this._getBlockPositions(i,t),n=this._getBlockColor(e,o,r),this._setBlockPixels(e,r,n)},TileGenerator.AlgoFilePixellation.prototype._drawTextConditional=function(e,t){var i,n,r,o=16;return e.font="bold "+o+"px serif",e.textBaseline="top",i=e.measureText(t),i.width>=this._settings.getWidth()?!1:(n=Math.round((this._settings.getWidth()-i.width)/2),r=Math.round((this._settings.getHeight()-o)/2),e.fillStyle="white",e.fillText(t,n,r),!0)},TileGenerator.AlgoFilePixellation.prototype._getBlockColor=function(e,t,i){var n,r,o,s=0,a=0,l=0,h=0;for(r=0;r<i.length;r+=1)o=this._getPixelIndex(e,i[r].x,i[r].y),h+=t[o++],l+=t[o++],a+=t[o++],s+=t[o++];return n=[Math.round(h/i.length),Math.round(l/i.length),Math.round(a/i.length),Math.round(s/i.length)]}}(),function(){"use strict";TileGenerator.AlgoFactory={},TileGenerator.AlgoFactory.getAlgoInstances=function(){var e=TileGenerator.Main.getRef().getSettings();return[new TileGenerator.AlgoBrick(e),new TileGenerator.AlgoNeighbor4(e),new TileGenerator.AlgoNeighbor8(e),new TileGenerator.AlgoPixellation(e),new TileGenerator.AlgoFilePixellation(e)]}}();