var TileGenerator={};!function(){"use strict";TileGenerator.Util={},TileGenerator.Util.extend=function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},TileGenerator.Util.randomizeArray=function(e){var t,o,i,r=e.length;for(t=0;t<e.length;t+=1)o=Math.floor(Math.random()*r),i=e[o],e[o]=e[r-1],e[r-1]=i,r-=1},TileGenerator.Util.getRandomWeightedIndex=function(e){var t,o,i=0,r=0;for(t=0;t<e.length;t+=1)i+=e[t];for(o=Math.floor(Math.random()*i),t=0;t<e.length;t+=1)if(r+=e[t],r>o||t===e.length-1)return t;return-1}}(),function(){"use strict";TileGenerator.Hex={},TileGenerator.Hex.Map={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15},TileGenerator.Hex.simpleToDecArray=function(e){var t=[];return t[0]=TileGenerator.Hex.hexComponentToDec(e.slice(1,3)),t[1]=TileGenerator.Hex.hexComponentToDec(e.slice(3,5)),t[2]=TileGenerator.Hex.hexComponentToDec(e.slice(5)),t},TileGenerator.Hex.hexComponentToDec=function(e){var t,o=0,i=0;for(t=e.length-1;t>=0;t-=1)i+=TileGenerator.Hex.Map[e[t]]*Math.pow(16,o),o+=1;return i},TileGenerator.Hex.isSimpleHex=function(e){return/^#([0-9a-f]{2}){3}$/i.test(e)}}(),function(){"use strict";TileGenerator.Dec={},TileGenerator.Dec.HexValues=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],TileGenerator.Dec.decArrayToSimpleHex=function(e){var t,o="#";for(t=0;t<e.length;t+=1)o+=TileGenerator.Dec.decComponentToHex(e[t]);return o},TileGenerator.Dec.decComponentToHex=function(e){for(var t="";0!==e;)t=TileGenerator.Dec.HexValues[e%16]+t,e=Math.floor(e/16);switch(t.length){case 0:t=TileGenerator.Dec.HexValues[0]+TileGenerator.Dec.HexValues[0];break;case 1:t=TileGenerator.Dec.HexValues[0]+t}return t}}(),function(){"use strict";TileGenerator.Settings=function(){this._width=96,this._height=96,this._colors=[[255,0,0],[0,255,0],[0,0,255]],this._colorWeights=[100,100,100]},TileGenerator.Settings.VERSION="1.1",TileGenerator.Settings.prototype.onLoad=function(){var e;try{e=window.localStorage.getItem("settings"),e&&(e=JSON.parse(e),this._width=e.width,this._height=e.height,e.version?this._colors=e.colors:this._colors=this._convertHexColors(e.colors),this._colorWeights=e.colorWeights)}catch(t){}window.addEventListener("beforeunload",this._saveSettings.bind(this))},TileGenerator.Settings.prototype.getWidth=function(){return this._width},TileGenerator.Settings.prototype.setWidth=function(e){return this._width=e,this},TileGenerator.Settings.prototype.getHeight=function(){return this._height},TileGenerator.Settings.prototype.setHeight=function(e){return this._height=e,this},TileGenerator.Settings.prototype.getColor=function(e){return this._colors[e]},TileGenerator.Settings.prototype.getColors=function(){return this._colors},TileGenerator.Settings.prototype.getNumColors=function(){return this._colors.length},TileGenerator.Settings.prototype.addColor=function(e){return this._colors.push(e),this},TileGenerator.Settings.prototype.updateColor=function(e,t){return this._colors[e]=t,this},TileGenerator.Settings.prototype.removeColor=function(e){return this._colors.splice(e,1),this},TileGenerator.Settings.prototype.getColorWeight=function(e){return this._colorWeights[e]},TileGenerator.Settings.prototype.getColorWeights=function(){return this._colorWeights},TileGenerator.Settings.prototype.getNumColorWeights=function(){return this._colorWeights.length},TileGenerator.Settings.prototype.addColorWeight=function(e){return this._colorWeights.push(e),this},TileGenerator.Settings.prototype.updateColorWeight=function(e,t){return this._colorWeights[e]=t,this},TileGenerator.Settings.prototype.removeColorWeight=function(e){return this._colorWeights.splice(e,1),this},TileGenerator.Settings.prototype._saveSettings=function(){var e;try{var e=JSON.stringify({version:TileGenerator.Settings.VERSION,width:this._width,height:this._height,colors:this._colors,colorWeights:this._colorWeights});window.localStorage.setItem("settings",e)}catch(t){}},TileGenerator.Settings.prototype._convertHexColors=function(e){var t,o=[];for(t=0;t<e.length;t+=1)o.push(TileGenerator.Hex.simpleToDecArray(e[t]));return o}}(),function(){"use strict";TileGenerator.Ui=function(){this._settings=null,this._canvasList={},this._ctxList={},this._canvasesElement=null,this._canvasContainerTplElement=null,this._colorsElement=null,this._newColorElement=null,this._colorContainerTplElement=null,this._redrawElement=null,this._sizeElement=null,this._sizes=[[32,32],[64,64],[96,96],[128,128],[160,160],[192,192]]},TileGenerator.Ui.prototype.onLoad=function(){this._settings=TileGenerator.Main.getRef().getSettings(),this._canvasesElement=document.getElementById("canvases-dynamic"),this._canvasContainerTplElement=document.getElementById("canvas-container-template"),this._colorsElement=document.getElementById("colors-dynamic"),this._newColorElement=document.getElementById("new-color-btn"),this._newColorElement.addEventListener("click",this._onAddColor.bind(this)),this._colorContainerTplElement=document.getElementById("color-container-template"),this._redrawElement=document.getElementById("redraw-btn"),this._redrawElement.addEventListener("click",this._onRedraw.bind(this)),this._sizeElement=document.getElementById("size"),this._populateSizes(),this._sizeElement.addEventListener("change",this._onChangeSize.bind(this)),this._addColorsFromSettings()},TileGenerator.Ui.prototype.addAlgoToDom=function(e){var t,o,i,r=!0,n=e.getId(),s=e.getTitle();i=this._canvasContainerTplElement.cloneNode(r),i.removeAttribute("id"),i.setAttribute("class","canvas-container"),i.querySelector(".title").textContent=s,t=i.querySelector("canvas"),t.width=this._settings.getWidth(),t.height=this._settings.getHeight(),t.setAttribute("title",s),o=t.getContext("2d"),this._canvasList[n]=t,this._ctxList[n]=o,this._canvasesElement.appendChild(i)},TileGenerator.Ui.prototype.getCanvas=function(e){return this._canvasList[e.getId()]},TileGenerator.Ui.prototype.getCtx=function(e){return this._ctxList[e.getId()]},TileGenerator.Ui.prototype._onAddColor=function(e){var t=this._colorContainerTplElement.querySelector(".color").value,o=parseInt(this._colorContainerTplElement.querySelector(".color-weight-range").value,10);this._addColorToDom(t,o),this._settings.addColor(TileGenerator.Hex.simpleToDecArray(t)).addColorWeight(o),this._redraw()},TileGenerator.Ui.prototype._onRemoveColor=function(e){var t,o;this._settings.getNumColors()>1?(t=this._getParentNodeByClass(e.target,"color-container"),o=this._getSiblingIndex(t),this._settings.removeColor(o).removeColorWeight(o),this._colorsElement.removeChild(t),this._redraw()):alert("You must keep at least 1 color.")},TileGenerator.Ui.prototype._onChangeColor=function(e){var t,o=this._getParentNodeByClass(e.target,"color-container");t=this._getSiblingIndex(o),this._settings.updateColor(t,TileGenerator.Hex.simpleToDecArray(e.target.value)),o.querySelector(".color-value").value=e.target.value,this._redraw()},TileGenerator.Ui.prototype._onInputColorValue=function(e){var t,o,i;TileGenerator.Hex.isSimpleHex(e.target.value)&&(t=this._getParentNodeByClass(e.target,"color-container"),o=t.querySelector(".color"),o.value=e.target.value,i=new Event("change"),o.dispatchEvent(i))},TileGenerator.Ui.prototype._onChangeColorValue=function(e){var t,o;TileGenerator.Hex.isSimpleHex(e.target.value)||(t=this._getParentNodeByClass(e.target,"color-container"),o=t.querySelector(".color"),e.target.value=o.value)},TileGenerator.Ui.prototype._onInputColorWeight=function(e){var t=this._getParentNodeByClass(e.target,"color-container");t.querySelector(".color-weight-value").textContent=e.target.value},TileGenerator.Ui.prototype._onChangeColorWeight=function(e){var t,o=this._getParentNodeByClass(e.target,"color-container");t=this._getSiblingIndex(o),this._settings.updateColorWeight(t,parseInt(e.target.value,10)),this._redraw()},TileGenerator.Ui.prototype._onChangeSize=function(e){var t=this._sizes[e.target.value];this._settings.setWidth(t[0]).setHeight(t[1]),this._resizeCanvases(),TileGenerator.Main.getRef().resized(),this._redraw()},TileGenerator.Ui.prototype._onRedraw=function(){this._redraw()},TileGenerator.Ui.prototype._redraw=function(){TileGenerator.Main.getRef().draw()},TileGenerator.Ui.prototype._addColorToDom=function(e,t){var o,i,r,n,s,l=!0;s=this._colorContainerTplElement.cloneNode(l),s.removeAttribute("id"),s.setAttribute("class","color-container"),o=s.querySelector(".color"),i=s.querySelector(".color-value"),r=s.querySelector(".color-weight-range"),n=s.querySelector(".color-weight-value"),o.value=e,i.value=e,r.value=t,n.textContent=t,s.querySelector(".remove-color-btn").addEventListener("click",this._onRemoveColor.bind(this)),o.addEventListener("change",this._onChangeColor.bind(this)),i.addEventListener("input",this._onInputColorValue.bind(this)),i.addEventListener("change",this._onChangeColorValue.bind(this)),r.addEventListener("input",this._onInputColorWeight.bind(this)),r.addEventListener("change",this._onChangeColorWeight.bind(this)),this._colorsElement.appendChild(s)},TileGenerator.Ui.prototype._addColorsFromSettings=function(){var e,t,o;for(e=this._settings.getColors(),t=this._settings.getColorWeights(),o=0;o<e.length;o+=1)this._addColorToDom(TileGenerator.Dec.decArrayToSimpleHex(e[o]),t[o])},TileGenerator.Ui.prototype._getParentNodeByClass=function(e,t){for(;null!==(e=e.parentNode);)if(e.classList.contains(t))return e;return null},TileGenerator.Ui.prototype._getSiblingIndex=function(e){for(var t=0;null!==(e=e.previousSibling);)t+=1;return t},TileGenerator.Ui.prototype._parseSize=function(e){return/^[1-9][0-9]*$/.test(e)?parseInt(e,10):null},TileGenerator.Ui.prototype._resizeCanvases=function(){var e;for(e in this._canvasList)this._canvasList.hasOwnProperty(e)&&(this._canvasList[e].width=this._settings.getWidth(),this._canvasList[e].height=this._settings.getHeight())},TileGenerator.Ui.prototype._populateSizes=function(){var e,t,o,i=this._settings.getHeight(),r=this._settings.getWidth();for(e=0;e<this._sizes.length;e+=1)o=document.createElement("option"),o.setAttribute("value",e),o.textContent=this._sizes[e][0]+"x"+this._sizes[e][1],this._sizeElement.appendChild(o),(0===e||this._sizes[e][0]==r&&this._sizes[e][1]==i)&&(t=o);t.setAttribute("selected","")}}(),function(){"use strict";var e=null;TileGenerator.Main=function(){this._settings=new TileGenerator.Settings,this._ui=new TileGenerator.Ui,this._algos=null},TileGenerator.Main.getRef=function(){return e},TileGenerator.Main.prototype.onLoad=function(){var e,t;for(this._settings.onLoad(),this._ui.onLoad(),this._algos=TileGenerator.AlgoFactory.getAlgoInstances(),t=0;t<this._algos.length;t+=1)this._ui.addAlgoToDom(this._algos[t]),e=this._ui.getCtx(this._algos[t]),this._algos[t].setup(e)},TileGenerator.Main.prototype.draw=function(){var e,t;for(t=0;t<this._algos.length;t+=1)e=this._ui.getCtx(this._algos[t]),e.clearRect(0,0,this._settings.getWidth(),this._settings.getHeight()),this._algos[t].draw(e)},TileGenerator.Main.prototype.resized=function(){var e,t;for(t=0;t<this._algos.length;t+=1)e=this._ui.getCtx(this._algos[t]),this._algos[t].resized(e)},TileGenerator.Main.prototype.getSettings=function(){return this._settings},window.onload=function(){e=new TileGenerator.Main,e.onLoad(),e.draw()}}(),function(){"use strict";TileGenerator.Algo=function(e){this._settings=e,this._id=null,this._title=null,this._imageData=null,this._imageDataArray=null},TileGenerator.Algo.prototype.setup=function(e){this._createImageData(e)},TileGenerator.Algo.prototype.resized=function(e){this._createImageData(e)},TileGenerator.Algo.prototype.draw=function(e){this._setPixels(e),this._drawPixels(e)},TileGenerator.Algo.prototype.getId=function(){return this._id},TileGenerator.Algo.prototype.getTitle=function(){return this._title},TileGenerator.Algo.prototype._setPixel=function(e,t,o){var i=4*(t.y*e.canvas.width+t.x);this._imageDataArray[i++]=o[0],this._imageDataArray[i++]=o[1],this._imageDataArray[i++]=o[2],this._imageDataArray[i++]=255},TileGenerator.Algo.prototype._drawPixels=function(e){e.putImageData(this._imageData,0,0)},TileGenerator.Algo.prototype._createImageData=function(e){this._imageData=e.createImageData(e.canvas.width,e.canvas.height),this._imageDataArray=this._imageData.data}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoRandom=function(t){e.call(this,t),this._id="random",this._title="Random"},TileGenerator.Util.extend(e,TileGenerator.AlgoRandom),TileGenerator.AlgoRandom.prototype._setPixels=function(e){var t,o,i,r=this._settings.getColors(),n=this._settings.getColorWeights(),s={};for(i=0;i<this._settings.getHeight();i+=1)for(o=0;o<this._settings.getWidth();o+=1)s.x=o,s.y=i,t=TileGenerator.Util.getRandomWeightedIndex(n),this._setPixel(e,s,r[t])}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoSmearing=function(t){e.call(this,t),this._id="smearing",this._title="Smearing"},TileGenerator.Util.extend(e,TileGenerator.AlgoSmearing),TileGenerator.AlgoSmearing.prototype._setPixels=function(e){var t,o,i,r=this._settings.getColors(),n=this._settings.getColorWeights(),s=5,l=0,a=20,h=!0,g={};for(i=0;i<this._settings.getHeight();i+=1)for(o=0;o<this._settings.getWidth();o+=1)h&&(t=TileGenerator.Util.getRandomWeightedIndex(n),l=0,h=!1),l+=1,l>s+Math.random()*a&&(h=!0),g.x=o,g.y=i,this._setPixel(e,g,r[t])}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoSquares=function(t){e.call(this,t),this._id="squares",this._title="Squares"},TileGenerator.Util.extend(e,TileGenerator.AlgoSquares),TileGenerator.AlgoSquares.prototype.draw=function(e){this._drawPixels(e)},TileGenerator.AlgoSquares.prototype._drawPixels=function(e){var t,o,i,r,n,s,l,a,h,g=this._settings.getColors(),c=this._settings.getColorWeights(),u=[],d=this._settings.getHeight(),_={},p=this._settings.getWidth();for(o=0;o<g.length;o+=1)u.push(TileGenerator.Dec.decArrayToSimpleHex(g[o]));for(i=p*d,l=Math.floor(p/100),s=Math.floor(d/100),n=Math.floor(p/10),r=Math.floor(d/10),e.fillStyle=u[0],e.fillRect(0,0,p,d),o=0;i>o;o+=1)t=TileGenerator.Util.getRandomWeightedIndex(c),a=n+Math.floor(Math.random()*l),h=r+Math.floor(Math.random()*s),_.x=Math.floor(Math.random()*p),_.y=Math.floor(Math.random()*d),_.x+a>=p&&(_.x=p-a),_.y+h>=d&&(_.y=d-h),e.fillStyle=u[t],e.fillRect(_.x,_.y,a,h)}}(),function(){"use strict";var e=TileGenerator.Algo;TileGenerator.AlgoNeighbor=function(t){e.call(this,t)},TileGenerator.Util.extend(e,TileGenerator.AlgoNeighbor),TileGenerator.AlgoNeighbor.prototype._setPixels=function(e){var t,o,i,r,n,s=this._settings.getColors(),l=this._settings.getColorWeights(),a=[],h={},g=[],c=0;for(n=0;n<this._settings.getHeight();n+=1)g.push(n),a[n]=[];for(TileGenerator.Util.randomizeArray(g),o={pixelColorIndices:a,x:0,y:0,numNeighbors:4},n=0;n<g.length;n+=1)for(r=0;r<this._settings.getWidth();r+=1)o.x=r,o.y=n,t=this._getRandomNeighborColorIndex(o),null===t&&(t=TileGenerator.Util.getRandomWeightedIndex(l)),i===t&&++c,c>10&&(c=0,t=TileGenerator.Util.getRandomWeightedIndex(l)),i=t,a[n][r]=t,h.x=r,h.y=n,this._setPixel(e,h,s[t])},TileGenerator.AlgoNeighbor.prototype._getRandomNeighborColorIndex=function(e){var t,o,i,r=[];if(e.y>0&&r.push({x:e.x,y:e.y-1}),e.y<this._settings.getHeight()-1&&r.push({x:e.x,y:e.y+1}),e.x>0&&r.push({x:e.x-1,y:e.y}),e.x<this._settings.getWidth()-1&&r.push({x:e.x+1,y:e.y}),0===r.length)return null;for(TileGenerator.Util.randomizeArray(r),t=0;t<r.length;t+=1)if(o=r[t].y,i=r[t].x,void 0!==e.pixelColorIndices[o][i])return e.pixelColorIndices[o][i];return null}}(),function(){"use strict";var e=TileGenerator.AlgoNeighbor;TileGenerator.AlgoNeighbor4=function(t){e.call(this,t),this._id="neighbor4",this._title="Neighbor 4"},TileGenerator.Util.extend(e,TileGenerator.AlgoNeighbor4),TileGenerator.AlgoNeighbor4.prototype.draw=function(t){e.prototype.draw.call(this,t)},TileGenerator.AlgoNeighbor4.prototype.getRandomNeighborColorIndex=function(t){return e.getRandomNeighborColorIndex.call(this,t)}}(),function(){"use strict";var e=TileGenerator.AlgoNeighbor;TileGenerator.AlgoNeighbor8=function(t){e.call(this,t),this._id="neighbor8",this._title="Neighbor 8"},TileGenerator.Util.extend(e,TileGenerator.AlgoNeighbor8),TileGenerator.AlgoNeighbor8.prototype.draw=function(t){e.prototype.draw.call(this,t)},TileGenerator.AlgoNeighbor8.prototype.getRandomNeighborColorIndex=function(t){return e.getRandomNeighborColorIndex.call(this,t)}}(),function(){"use strict";TileGenerator.AlgoFactory={},TileGenerator.AlgoFactory.getAlgoInstances=function(){var e=TileGenerator.Main.getRef().getSettings();return[new TileGenerator.AlgoRandom(e),new TileGenerator.AlgoSmearing(e),new TileGenerator.AlgoSquares(e),new TileGenerator.AlgoNeighbor4(e),new TileGenerator.AlgoNeighbor8(e)]}}();