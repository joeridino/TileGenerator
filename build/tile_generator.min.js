var TileGenerator={};!function(){"use strict";TileGenerator.Util={},TileGenerator.Util.extend=function(t,e){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},TileGenerator.Util.randomizeArray=function(t){var e,o,i,r=t.length;for(e=0;e<t.length;e+=1)o=Math.floor(Math.random()*r),i=t[o],t[o]=t[r-1],t[r-1]=i,r-=1},TileGenerator.Util.getRandomWeightedIndex=function(t){var e,o,i=0,r=0;for(e=0;e<t.length;e+=1)i+=t[e];for(o=Math.floor(Math.random()*i),e=0;e<t.length;e+=1)if(r+=t[e],r>o||e===t.length-1)return e;return-1}}(),function(){"use strict";TileGenerator.Settings=function(){this._width=64,this._height=64,this._colors=["#ff0000","#00ff00","#0000ff"],this._colorWeights=[100,100,100]},TileGenerator.Settings.prototype.onLoad=function(){var t=window.localStorage.getItem("colors"),e=window.localStorage.getItem("color_weights");try{t&&(this._colors=JSON.parse(t)),e&&(this._colorWeights=JSON.parse(e))}catch(o){}},TileGenerator.Settings.prototype.getWidth=function(){return this._width},TileGenerator.Settings.prototype.setWidth=function(t){return this._width=t,this},TileGenerator.Settings.prototype.getHeight=function(){return this._height},TileGenerator.Settings.prototype.setHeight=function(t){return this._height=t,this},TileGenerator.Settings.prototype.getColor=function(t){return this._colors[t]},TileGenerator.Settings.prototype.getColors=function(){return this._colors},TileGenerator.Settings.prototype.getNumColors=function(){return this._colors.length},TileGenerator.Settings.prototype.addColor=function(t){return this._colors.push(t),this},TileGenerator.Settings.prototype.updateColor=function(t,e){return this._colors[t]=e,this},TileGenerator.Settings.prototype.removeColor=function(t){return this._colors.splice(t,1),this},TileGenerator.Settings.prototype.getColorWeight=function(t){return this._colorWeights[t]},TileGenerator.Settings.prototype.getColorWeights=function(){return this._colorWeights},TileGenerator.Settings.prototype.getNumColorWeights=function(){return this._colorWeights.length},TileGenerator.Settings.prototype.addColorWeight=function(t){return this._colorWeights.push(t),this},TileGenerator.Settings.prototype.updateColorWeight=function(t,e){return this._colorWeights[t]=e,this},TileGenerator.Settings.prototype.removeColorWeight=function(t){return this._colorWeights.splice(t,1),this}}(),function(){"use strict";TileGenerator.Ui=function(){this._settings=null,this._canvasList={},this._ctxList={},this._canvasesElement=null,this._canvasContainerTplElement=null,this._colorsElement=null,this._newColorElement=null,this._colorContainerTplElement=null,this._widthElement=null,this._heightElement=null,this._redrawElement=null},TileGenerator.Ui.prototype.onLoad=function(){this._settings=TileGenerator.Main.getRef().getSettings(),this._canvasesElement=document.getElementById("canvases"),this._canvasContainerTplElement=document.getElementById("canvas-container-template"),this._colorsElement=document.getElementById("colors"),this._newColorElement=document.getElementById("new-color-btn"),this._newColorElement.addEventListener("click",this._onAddColor.bind(this)),this._colorContainerTplElement=document.getElementById("color-container-template"),this._widthElement=document.getElementById("width"),this._widthElement.value=this._settings.getWidth(),this._widthElement.addEventListener("input",this._onInputWidth.bind(this)),this._widthElement.addEventListener("change",this._onChangeWidth.bind(this)),this._heightElement=document.getElementById("height"),this._heightElement.value=this._settings.getHeight(),this._heightElement.addEventListener("input",this._onInputHeight.bind(this)),this._heightElement.addEventListener("change",this._onChangeHeight.bind(this)),this._redrawElement=document.getElementById("redraw-btn"),this._redrawElement.addEventListener("click",this._onRedraw.bind(this)),this._addColorsFromSettings()},TileGenerator.Ui.prototype.addAlgoToDom=function(t){var e,o,i,r=!0,n=t.getId();i=this._canvasContainerTplElement.cloneNode(r),i.removeAttribute("id"),i.setAttribute("class","canvas-container"),i.querySelector(".title").textContent=t.getTitle(),e=i.querySelector("canvas"),e.width=this._settings.getWidth(),e.height=this._settings.getHeight(),o=e.getContext("2d"),this._canvasList[n]=e,this._ctxList[n]=o,this._canvasesElement.appendChild(i)},TileGenerator.Ui.prototype.getCanvas=function(t){return this._canvasList[t.getId()]},TileGenerator.Ui.prototype.getCtx=function(t){return this._ctxList[t.getId()]},TileGenerator.Ui.prototype._onAddColor=function(t){var e=this._colorContainerTplElement.querySelector(".color").value,o=parseInt(this._colorContainerTplElement.querySelector(".color-weight-range").value,10);this._addColorToDom(e,o),this._settings.addColor(e).addColorWeight(o),this._redraw()},TileGenerator.Ui.prototype._onRemoveColor=function(t){var e,o;this._settings.getNumColors()>1?(e=this._getParentNodeByClass(t.target,"color-container"),o=this._getSiblingIndex(e),this._settings.removeColor(o).removeColorWeight(o),this._colorsElement.removeChild(e),this._redraw()):alert("You must keep at least 1 color.")},TileGenerator.Ui.prototype._onChangeColor=function(t){var e,o=this._getParentNodeByClass(t.target,"color-container");e=this._getSiblingIndex(o),this._settings.updateColor(e,t.target.value),o.querySelector(".color-value").value=t.target.value,this._redraw()},TileGenerator.Ui.prototype._onInputColorValue=function(t){var e,o,i;this._isValidColor(t.target.value)&&(e=this._getParentNodeByClass(t.target,"color-container"),o=e.querySelector(".color"),o.value=t.target.value,i=new Event("change"),o.dispatchEvent(i))},TileGenerator.Ui.prototype._onChangeColorValue=function(t){var e,o;this._isValidColor(t.target.value)||(e=this._getParentNodeByClass(t.target,"color-container"),o=e.querySelector(".color"),t.target.value=o.value)},TileGenerator.Ui.prototype._onInputColorWeight=function(t){var e=this._getParentNodeByClass(t.target,"color-container");e.querySelector(".color-weight-value").textContent=t.target.value},TileGenerator.Ui.prototype._onChangeColorWeight=function(t){var e,o=this._getParentNodeByClass(t.target,"color-container");e=this._getSiblingIndex(o),this._settings.updateColorWeight(e,parseInt(t.target.value,10)),this._redraw()},TileGenerator.Ui.prototype._onInputWidth=function(t){var e=this._parseSize(t.target.value);e&&(this._settings.setWidth(e),this._resizeCanvases(),this._redraw())},TileGenerator.Ui.prototype._onChangeWidth=function(t){var e=this._parseSize(t.target.value);e||(t.target.value=this._settings.getWidth())},TileGenerator.Ui.prototype._onInputHeight=function(t){var e=this._parseSize(t.target.value);e&&(this._settings.setHeight(e),this._resizeCanvases(),this._redraw())},TileGenerator.Ui.prototype._onChangeHeight=function(t){var e=this._parseSize(t.target.value);e||(t.target.value=this._settings.getHeight())},TileGenerator.Ui.prototype._onRedraw=function(){this._redraw()},TileGenerator.Ui.prototype._redraw=function(){TileGenerator.Main.getRef().draw()},TileGenerator.Ui.prototype._addColorToDom=function(t,e){var o,i,r,n,l,s=!0;l=this._colorContainerTplElement.cloneNode(s),l.removeAttribute("id"),l.setAttribute("class","color-container"),o=l.querySelector(".color"),i=l.querySelector(".color-value"),r=l.querySelector(".color-weight-range"),n=l.querySelector(".color-weight-value"),o.value=t,i.value=t,r.value=e,n.textContent=e,l.querySelector(".remove-color-btn").addEventListener("click",this._onRemoveColor.bind(this)),o.addEventListener("change",this._onChangeColor.bind(this)),i.addEventListener("input",this._onInputColorValue.bind(this)),i.addEventListener("change",this._onChangeColorValue.bind(this)),r.addEventListener("input",this._onInputColorWeight.bind(this)),r.addEventListener("change",this._onChangeColorWeight.bind(this)),this._colorsElement.appendChild(l)},TileGenerator.Ui.prototype._addColorsFromSettings=function(){var t,e,o;for(t=this._settings.getColors(),e=this._settings.getColorWeights(),o=0;o<t.length;o+=1)this._addColorToDom(t[o],e[o])},TileGenerator.Ui.prototype._getParentNodeByClass=function(t,e){for(;null!==(t=t.parentNode);)if(t.classList.contains(e))return t;return null},TileGenerator.Ui.prototype._getSiblingIndex=function(t){for(var e=0;null!==(t=t.previousSibling);)e+=1;return e},TileGenerator.Ui.prototype._isValidColor=function(t){return/^#([0-9a-f]{2}){3}$/i.test(t)},TileGenerator.Ui.prototype._parseSize=function(t){return/^[1-9][0-9]*$/.test(t)?parseInt(t,10):null},TileGenerator.Ui.prototype._resizeCanvases=function(){var t;for(t in this._canvasList)this._canvasList.hasOwnProperty(t)&&(this._canvasList[t].width=this._settings.getWidth(),this._canvasList[t].height=this._settings.getHeight())}}(),function(){"use strict";var t=null;TileGenerator.Main=function(){this._settings=new TileGenerator.Settings,this._ui=new TileGenerator.Ui,this._algos=null},TileGenerator.Main.getRef=function(){return t},TileGenerator.Main.prototype.onLoad=function(){var t;for(this._settings.onLoad(),this._ui.onLoad(),this._algos=TileGenerator.AlgoFactory.getAlgoInstances(),t=0;t<this._algos.length;t+=1)this._ui.addAlgoToDom(this._algos[t])},TileGenerator.Main.prototype.draw=function(){var t,e;for(e=0;e<this._algos.length;e+=1)t=this._ui.getCtx(this._algos[e]),t.clearRect(0,0,this._settings.getWidth(),this._settings.getHeight()),this._algos[e].draw(t)},TileGenerator.Main.prototype.getSettings=function(){return this._settings},window.onload=function(){t=new TileGenerator.Main,t.onLoad(),t.draw()}}(),function(){"use strict";TileGenerator.Algo=function(t){this._settings=t,this._id=null,this._title=null},TileGenerator.Algo.prototype.draw=function(t){},TileGenerator.Algo.prototype.getId=function(){return this._id},TileGenerator.Algo.prototype.getTitle=function(){return this._title},TileGenerator.Algo.prototype._drawPixel=function(t,e,o){t.fillStyle=o,t.fillRect(e.x,e.y,1,1)}}(),function(){"use strict";var t=TileGenerator.Algo;TileGenerator.AlgoRandom=function(e){t.call(this,e),this._id="random",this._title="Random Pixels"},TileGenerator.Util.extend(t,TileGenerator.AlgoRandom),TileGenerator.AlgoRandom.prototype.draw=function(t){var e,o,i,r=this._settings.getColors(),n=this._settings.getColorWeights(),l={};for(i=0;i<this._settings.getHeight();i+=1)for(o=0;o<this._settings.getWidth();o+=1)l.x=o,l.y=i,e=TileGenerator.Util.getRandomWeightedIndex(n),this._drawPixel(t,l,r[e])}}(),function(){"use strict";var t=TileGenerator.Algo;TileGenerator.AlgoSmearing=function(e){t.call(this,e),this._id="smearing",this._title="Smearing"},TileGenerator.Util.extend(t,TileGenerator.AlgoSmearing),TileGenerator.AlgoSmearing.prototype.draw=function(t){var e,o,i,r=this._settings.getColors(),n=this._settings.getColorWeights(),l=0,s=!0,a={};for(i=0;i<this._settings.getHeight();i+=1)for(o=0;o<this._settings.getWidth();o+=1)s&&(e=TileGenerator.Util.getRandomWeightedIndex(n),l=0,s=!1),l+=1,l>5+20*Math.random()&&(s=!0),a.x=o,a.y=i,this._drawPixel(t,a,r[e])}}(),function(){"use strict";var t=TileGenerator.Algo;TileGenerator.AlgoSquares=function(e){t.call(this,e),this._id="squares",this._title="Random Squares"},TileGenerator.Util.extend(t,TileGenerator.AlgoSquares),TileGenerator.AlgoSquares.prototype.draw=function(t){var e,o,i,r,n=this._settings.getColors(),l=this._settings.getColorWeights(),s=this._settings.getHeight(),a={},h=this._settings.getWidth();for(t.fillStyle=n[0],t.fillRect(0,0,h,s),o=0;100>o;o+=1)e=TileGenerator.Util.getRandomWeightedIndex(l),i=4+Math.floor(4*Math.random()),r=4+Math.floor(4*Math.random()),a.x=Math.floor(Math.random()*h-i),a.y=Math.floor(Math.random()*s-r),this._drawPixel(t,a,n[e])}}(),function(){"use strict";var t=TileGenerator.Algo;TileGenerator.AlgoNeighbor=function(e){t.call(this,e)},TileGenerator.Util.extend(t,TileGenerator.AlgoNeighbor),TileGenerator.AlgoNeighbor.prototype.draw=function(t){var e,o,i,r,n,l=this._settings.getColors(),s=this._settings.getColorWeights(),a=[],h={},g=[],u=0;for(n=0;n<this._settings.getHeight();n+=1)g.push(n),a[n]=[];for(TileGenerator.Util.randomizeArray(g),o={pixelColorIndices:a,x:0,y:0,numNeighbors:4},n=0;n<g.length;n+=1)for(r=0;r<this._settings.getWidth();r+=1)o.x=r,o.y=n,e=this._getRandomNeighborColorIndex(o),null===e&&(e=TileGenerator.Util.getRandomWeightedIndex(s)),i===e&&++u,u>10&&(u=0,e=TileGenerator.Util.getRandomWeightedIndex(s)),i=e,a[n][r]=e,h.x=r,h.y=n,this._drawPixel(t,h,l[e])},TileGenerator.AlgoNeighbor.prototype._getRandomNeighborColorIndex=function(t){var e,o,i,r=[];if(t.y>0&&r.push({x:t.x,y:t.y-1}),t.y<this._settings.getHeight()-1&&r.push({x:t.x,y:t.y+1}),t.x>0&&r.push({x:t.x-1,y:t.y}),t.x<this._settings.getWidth()-1&&r.push({x:t.x+1,y:t.y}),0===r.length)return null;for(TileGenerator.Util.randomizeArray(r),e=0;e<r.length;e+=1)if(o=r[e].y,i=r[e].x,void 0!==t.pixelColorIndices[o][i])return t.pixelColorIndices[o][i];return null}}(),function(){"use strict";var t=TileGenerator.AlgoNeighbor;TileGenerator.AlgoNeighbor4=function(e){t.call(this,e),this._id="neighbor4",this._title="Neighbor 4"},TileGenerator.Util.extend(t,TileGenerator.AlgoNeighbor4),TileGenerator.AlgoNeighbor4.prototype.draw=function(e){t.prototype.draw.call(this,e)},TileGenerator.AlgoNeighbor4.prototype.getRandomNeighborColorIndex=function(e){return t.getRandomNeighborColorIndex.call(this,e)}}(),function(){"use strict";var t=TileGenerator.AlgoNeighbor;TileGenerator.AlgoNeighbor8=function(e){t.call(this,e),this._id="neighbor8",this._title="Neighbor 8"},TileGenerator.Util.extend(t,TileGenerator.AlgoNeighbor8),TileGenerator.AlgoNeighbor8.prototype.draw=function(e){t.prototype.draw.call(this,e)},TileGenerator.AlgoNeighbor8.prototype.getRandomNeighborColorIndex=function(e){return t.getRandomNeighborColorIndex.call(this,e)}}(),function(){"use strict";TileGenerator.AlgoFactory={},TileGenerator.AlgoFactory.getAlgoInstances=function(){var t=TileGenerator.Main.getRef().getSettings();return[new TileGenerator.AlgoRandom(t),new TileGenerator.AlgoSmearing(t),new TileGenerator.AlgoSquares(t),new TileGenerator.AlgoNeighbor4(t),new TileGenerator.AlgoNeighbor8(t)]}}();